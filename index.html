<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Team Auction App</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
    .hidden { display: none; }
    .section { background: white; padding: 20px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    input, button, select, textarea { padding: 8px; margin: 5px 0; width: 100%; box-sizing: border-box; }
    .team-container { margin-top: 20px; }
    .team { background: #e6f7ff; padding: 10px; margin-top: 10px; border-radius: 6px; }
    .players { margin-left: 20px; }
    .error { color: red; font-size: 0.9em; }
    .spinner { font-size: 1.5em; animation: spin 1s linear infinite; display: inline-block; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .navigation-buttons { display: flex; gap: 10px; margin-top: 20px; }
    .remaining-players { margin-top: 20px; padding: 10px; background: #fff7e6; border-radius: 6px; }
  </style>
</head>
<body>
  <h1>Team Auction App</h1>

  <!-- Page 1 -->
  <div class="section" id="page1">
    <h2>Setup Teams</h2>
    <label>Number of Teams:</label>
    <input type="number" id="numTeams" min="1">
    <label>Fixed Amount for Each Team:</label>
    <input type="number" id="fixedAmount" min="1">

    <h3>Player Categories</h3>
    <label>Enter Categories (e.g. A:100,B:75,C:50):</label>
    <textarea id="categories" placeholder="A:100,B:75,C:50"></textarea>

    <div id="teamNamesSection"></div>
    <div class="navigation-buttons">
      <button onclick="createTeamInputs()">Next</button>
    </div>
  </div>

  <!-- Page 2 -->
  <div class="section hidden" id="page2">
    <h2>Enter All Player Names and Categories</h2>
    <label>Total Number of Players:</label>
    <input type="number" id="numPlayers" min="1">
    <div id="playerNamesSection"></div>
    <div class="navigation-buttons">
      <button onclick="goToPage(1)">Previous</button>
      <button onclick="createPlayerInputs()">Next</button>
    </div>
  </div>

  <!-- Page 3 -->
  <div class="section hidden" id="page3">
    <h2>Auction</h2>
    <div class="navigation-buttons">
      <button onclick="goToPage(2)">Previous</button>
    </div>
    <div id="spinner" class="spinner hidden">ðŸŽ¯</div>
    <button onclick="spinAndAssignPlayer()" id="spinButton">Spin for Player</button>
    <div id="spinnerResult" style="margin: 20px 0; font-weight: bold;"></div>

    <label>Select Team:</label>
    <select id="teamSelect"></select>

    <label>Amount Paid:</label>
    <input type="number" id="amountPaid" min="0">
    <div class="error" id="errorMsg"></div>
    <button onclick="assignPlayerToTeam()">Assign Player</button>

    <h3>Teams Overview</h3>
    <div id="teamsDisplay" class="team-container"></div>

    <h3>Remaining Players</h3>
    <div class="remaining-players" id="remainingPlayers"></div>

    <h3>Unassigned Players</h3>
    <ul id="unsoldList"></ul>
  </div>

  <script>
    let teams = {};
    let players = [];
    let currentPlayer = null;
    let categories = {};
    let unassignedPlayers = [];

    function goToPage(num) {
      for (let i = 1; i <= 3; i++) {
        document.getElementById(`page${i}`).classList.add('hidden');
      }
      document.getElementById(`page${num}`).classList.remove('hidden');
    }

    function createTeamInputs() {
      const num = parseInt(document.getElementById('numTeams').value);
      const fixed = parseFloat(document.getElementById('fixedAmount').value);
      const categoryInput = document.getElementById('categories').value;

      categoryInput.split(',').forEach(item => {
        const [cat, val] = item.split(':');
        categories[cat.trim()] = parseFloat(val);
      });

      const section = document.getElementById('teamNamesSection');
      section.innerHTML = '';
      if (!num || !fixed || Object.keys(categories).length === 0) return;

      for (let i = 0; i < num; i++) {
        const input = document.createElement('input');
        input.placeholder = `Enter name of team ${i + 1}`;
        input.id = `teamName${i}`;
        section.appendChild(input);
      }

      const btn = document.createElement('button');
      btn.textContent = 'Go to Player Page';
      btn.onclick = () => {
        const teamNames = [];
        for (let i = 0; i < num; i++) {
          const name = document.getElementById(`teamName${i}`).value;
          if (name) teamNames.push(name);
        }
        if (teamNames.length === num) {
          initializeTeams(teamNames, fixed);
          goToPage(2);
        }
      };
      section.appendChild(btn);
    }

    function initializeTeams(names, fixed) {
      teams = {};
      const select = document.getElementById('teamSelect');
      select.innerHTML = '';
      for (const name of names) {
        teams[name] = { fixed_amount: fixed, players: [] };
        const option = document.createElement('option');
        option.value = name;
        option.textContent = name;
        select.appendChild(option);
      }
    }

    function createPlayerInputs() {
      const num = parseInt(document.getElementById('numPlayers').value);
      const section = document.getElementById('playerNamesSection');
      section.innerHTML = '';
      if (!num) return;

      for (let i = 0; i < num; i++) {
        const nameInput = document.createElement('input');
        nameInput.placeholder = `Enter name of player ${i + 1}`;
        nameInput.id = `playerName${i}`;

        const categorySelect = document.createElement('select');
        categorySelect.id = `playerCategory${i}`;
        for (const cat in categories) {
          const opt = document.createElement('option');
          opt.value = cat;
          opt.textContent = cat;
          categorySelect.appendChild(opt);
        }

        section.appendChild(nameInput);
        section.appendChild(categorySelect);
      }

      const btn = document.createElement('button');
      btn.textContent = 'Go to Auction Page';
      btn.onclick = () => {
        players = [];
        for (let i = 0; i < num; i++) {
          const name = document.getElementById(`playerName${i}`).value;
          const category = document.getElementById(`playerCategory${i}`).value;
          if (name && category) players.push({ name, category });
        }
        if (players.length === num) {
          goToPage(3);
          updateTeamDisplay();
          updateRemainingPlayers();
        }
      };
      section.appendChild(btn);
    }

    function spinAndAssignPlayer() {
      if (currentPlayer) {
        unassignedPlayers.push(currentPlayer);
        currentPlayer = null;
      }

      if (players.length === 0) {
        document.getElementById('spinnerResult').textContent = 'All players assigned!';
        document.getElementById('spinButton').style.display = 'none';
        updateTeamDisplay();
        return;
      }

      document.getElementById('spinner').classList.remove('hidden');
      setTimeout(() => {
        document.getElementById('spinner').classList.add('hidden');
        const index = Math.floor(Math.random() * players.length);
        currentPlayer = players.splice(index, 1)[0];
        document.getElementById('spinnerResult').textContent = `ðŸŽ¯ Selected Player: ${currentPlayer.name} (Category: ${currentPlayer.category})`;
        document.getElementById('amountPaid').value = categories[currentPlayer.category];
        updateRemainingPlayers();
      }, 1000);
    }

    function assignPlayerToTeam() {
      const team = document.getElementById('teamSelect').value;
      const amount = parseFloat(document.getElementById('amountPaid').value);
      const error = document.getElementById('errorMsg');
      error.textContent = '';

      if (!currentPlayer) {
        error.textContent = 'Spin to select a player first!';
        return;
      }

      if (isNaN(amount)) {
        error.textContent = 'Enter a valid amount';
        return;
      }

      if (amount > teams[team].fixed_amount) {
        error.textContent = `Insufficient funds! ${team} only has $${teams[team].fixed_amount.toFixed(2)} remaining.`;
        return;
      }

      teams[team].players.push({ name: currentPlayer.name, amount_paid: amount });
      teams[team].fixed_amount -= amount;
      currentPlayer = null;
      document.getElementById('amountPaid').value = '';
      document.getElementById('spinnerResult').textContent = '';
      updateTeamDisplay();
    }

    function updateTeamDisplay() {
      const container = document.getElementById('teamsDisplay');
      const unsoldList = document.getElementById('unsoldList');
      container.innerHTML = '';
      unsoldList.innerHTML = '';
      for (const team in teams) {
        const div = document.createElement('div');
        div.className = 'team';
        div.innerHTML = `<strong>${team}</strong> (Remaining: $${teams[team].fixed_amount.toFixed(2)})`;
        if (teams[team].players.length > 0) {
          const ul = document.createElement('ul');
          ul.className = 'players';
          for (const player of teams[team].players) {
            const li = document.createElement('li');
            li.textContent = `${player.name} ($${player.amount_paid.toFixed(2)})`;
            ul.appendChild(li);
          }
          div.appendChild(ul);
        } else {
          div.innerHTML += '<div class="players">No players assigned yet.</div>';
        }
        container.appendChild(div);
      }

      for (const player of unassignedPlayers) {
        const li = document.createElement('li');
        li.textContent = `${player.name} (Category: ${player.category})`;
        unsoldList.appendChild(li);
      }
    }

    function updateRemainingPlayers() {
      const div = document.getElementById('remainingPlayers');
      div.innerHTML = players.map(p => `${p.name} (${p.category})`).join('<br>');
    }
  </script>
</body>
</html>
